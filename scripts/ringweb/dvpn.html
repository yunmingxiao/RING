<!DOCTYPE html>
<html lang="en">
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/codemirror.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/codemirror.min.css" /> -->

<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
.w3-bar,h1,button {font-family: "Montserrat", sans-serif}
.fa-anchor,.fa-coffee {font-size:200px}
.menu-unselect {float:left;width:auto;border:none;display:block;outline:0;white-space:normal;padding:12px 24px;text-decoration:none}
.menu-unselect:hover{color:#000!important;background-color:#fff!important}
.menu-selected {float:left;width:auto;border:none;display:block;outline:0;white-space:normal;padding:12px 24px;text-decoration:none;color:#000!important;background-color:#fff!important}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script>
  // function ApplyCodeMirror() {
  //   myTextArea = document.getElementById('bandwidth-code');
  //   CodeMirror.fromTextArea(myTextArea, {
  //     lineNumbers: true, 
  //     mode: {
  //       name: "text/x-python", 
  //       version: 3, 
  //       indentUnit: 4, 
  //       matchBrackets: true
  //     }});
  //   myTextArea = document.getElementById('price-code');
  //   CodeMirror.fromTextArea(myTextArea, {
  //     lineNumbers: true, 
  //     mode: {
  //       name: "text/x-python", 
  //       version: 3, 
  //       indentUnit: 4, 
  //       matchBrackets: true
  //     }});
  // }

  function Fold(name) {
    var obj = document.getElementById(name);
    if (obj.style.display == 'none') {
      obj.style.display = 'block';
    } else {
      obj.style.display = 'none';
    }
  }

  var custom_errors = '';
  function GetCustomError() {
    $.ajax({
      type : "GET",
      url : document.URL,
      data: {"action": "errors"},
      dataType: "text",
      success: function(data) {
        custom_errors = data;
        if (custom_errors.length > 0) {
          document.getElementById('error-warn1').style.visibility = "visible";
          document.getElementById('error-warn2').style.visibility = "visible";
        }
      }
    });
  }

  function RestoreDefaultPolicy() {
    $.ajax({
      type : "GET",
      url : document.URL,
      data: {"action": "restore_default"},
      dataType: "text",
      success: function(data) {
        custom_errors = data;
      }
    });
  }

  function SubmitCustomCode() {
    var note = "Click OK to confirm submitting the custom code\n(Note: You need to click both \"Auto Control\" and \"Custom\" buttons to apply the custom policy)";
    var cf = confirm(note);
    if (!cf) {
      return;
    }
    code = document.getElementById('policy-code').value;
    submission = JSON.stringify({
       "code": code,
    });
    $.ajax({
        type: "POST",
        url: document.URL+'-custom-code/',
        contentType: "application/json",
        dataType: "json",
        data: submission,
        success: function() {alert("Submitted!");},
        error: function(){ alert('Operation Failed!');},
    });
    GetCustomError();
  }

  function GetCustomCode() {
    $.ajax({
      type : "GET",
      url : document.URL,
      data: {"action": "code"},
      dataType: "text",
      success: function(data) {
        document.getElementById('policy-code').value = data;
      }
    });
  }

  function SubmitDVPN() {
    submission = JSON.stringify({
       "eth-address": document.getElementById("eth-address").value,
       "data-plan": document.getElementById("data-plan").value,
       "bandwidth-limit": document.getElementById("bandwidth-limit").value,
       "auto-bandwidth": document.getElementById("auto-bandwidth").checked,
       "price-setting": document.getElementById("price-setting").value,
       "auto-price": document.getElementById("auto-price").checked,
       "custom-bandwidth-policy": document.getElementById("custom-bandwidth-policy").checked,
       "custom-price-policy": document.getElementById("custom-price-policy").checked,
    });
    var note = "Click OK to confirm submitting the settings";
    if (document.URL.includes("sentinel")) {
      note = note + "\n(The change for ETH address will only take effect after restart Sentinel)"
    }
    var cf = confirm(note);
    if (!cf) {
      return;
    }
    $.ajax({
        type: "POST",
        url: document.URL,
        contentType: "application/json",
        dataType: "text",
        data: submission,
        success: function() {alert("Submitted!");},
        error: function(){ alert('Submitted!');},
    });
  };

  function UpdateStatus() {
    $.ajax({
      type : "GET",
      url : document.URL,
      data: {"action": "status"},
      dataType: "json",
      success: function(data) {
        for (var key in data) {
          try {
            if (key.includes("auto-") || key.includes("block-") || key.includes("custom-")) {
              document.getElementById(key).checked = data[key];
            }
            else if (key == "used-data") {
              var used = "Used: ";
              if (data[key] > 1000000000000)
                used += (data[key]/1000000000000).toFixed(2) + " TB";
              else if (data[key] > 1000000000)
                used += (data[key]/1000000000).toFixed(2) + " GB";
              else if (data[key] > 1000000)
                used += (data[key]/1000000).toFixed(2) + " MB";
              else if (data[key] > 1000)
                used += (data[key]/1000).toFixed(2) + " KB";
              else
                used += (data[key]).toFixed(2) + " B";
              document.getElementById(key).innerHTML = used;
            }
            else {
              document.getElementById(key).value = data[key];
            }
          }
          catch (err) {
            alert(err);
          }
        }
      }
    });
  };

  function Action(action) {
    if (action != "running-status") {
      var cf = confirm("Click OK to confirm " + action +  "ing this VPN");
      if (!cf) {
        return;
      }
      document.getElementById("running-status").textContent = action + "ing...";
      document.getElementById("running-status").style = "color: orange";
    }
    var status = $.ajax({
      type : "GET",
      url : document.URL,
      data: {"action": action},
      dataType: "text",
      success: function(data) {
        try {
          document.getElementById("running-status").textContent = data;
          var runningStyle = "color: green"
          if (data == "Running") {
            runningStyle = "color: green"
          } else if (data.includes("...")) {
            runningStyle = "color: orange"
          } else {
            runningStyle = "color: red"
          }
          document.getElementById("running-status").style = runningStyle;
        }
        catch (err) {
          alert(err);
        }
      }
    });
  }

  function MenuSelect() {
    var menus = document.URL.split("/");
    var current_menu = "a-" + menus[menus.length - 1];
    document.getElementById(current_menu).className = "menu-selected";
  }
</script>

<body onload="MenuSelect();UpdateStatus();Action('running-status');GetCustomError();GetCustomCode()">

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-grey w3-card w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-grey" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="index" class="menu-unselect" id="a-index">Overall</a>
    <!-- <a href="password" class="menu-unselect" id="a-password">Password Reset</a> -->
    <a href="mysterium" class="menu-unselect" id="a-mysterium">Mysterium</a>
    <a href="sentinel" class="menu-unselect" id="a-sentinel">Sentinel</a>
    <a href="tachyon" class="menu-unselect" id="a-tachyon">Tachyon</a>
    <a href="agreement" class="menu-unselect" id="a-agreement">Agreement</a>
    <!-- <a href="tachyon" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Tachyon</a> -->
  </div>
</div>

<!-- Header -->
<!-- <header class="w3-container w3-grey w3-center" style="padding:128px 16px">
  <h1 class="w3-margin w3-jumbo">START PAGE</h1>
  <p class="w3-xlarge">Template by w3.css</p>
  <button class="w3-button w3-black w3-padding-large w3-large w3-margin-top">Get Started</button>
</header> -->

<!-- First Grid -->
<div class="w3-row-padding w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-col w3-padding"><p style="visibility:hidden">padding</p></div>

    <div class="w3-center">
      <p class="w3-large"><span>Running Status: </span> <span style="color: green" id="running-status"></span> </p> 
      <button onclick="Action('start')">Start</button>
      <button onclick="Action('terminate')">Terminate</button>
      <button onclick="Action('restart')">Restart</button>
    </div>

    <div class="w3-center w3-row w3-section" style="padding-top: 8px">
      <div class="w3-col s3 w3-center w3-white"><p style="visibility:hidden">padding</p></div>
      <div class="w3-col s2" style="padding-top: 8px">ETH Address: </div>
      <div class="w3-col s4">
        <input class="w3-input" type="text" placeholder="0xfff..." id="eth-address">
      </div>  
    </div>

    <div class="w3-center w3-row w3-section" style="padding-top: 8px">
      <div class="w3-col s3 w3-center w3-white"><p style="visibility:hidden">padding</p></div>
      <div class="w3-col s2" style="padding-top: 8px">Data Plan: </div>
      <div class="w3-col s1">
        <input class="w3-input" type="number" step="any" placeholder="0" id="data-plan">
      </div>  
      <div class="w3-col s1" style="padding-left: 8px; text-align: left">GB / Month</div>
      <div class="w3-col s2" style="padding-top: 8px; padding-left: 24px; text-align: left" id="used-data">Used: 0 B</div>
    </div>

    <div class="w3-center w3-row w3-section" style="padding-top: 8px">
      <div class="w3-col s3 w3-center w3-white"><p style="visibility:hidden">padding</p></div>
      <div class="w3-col s2" style="padding-top: 8px">Bandwidth Limit: </div>
      <div class="w3-col s1">
        <input class="w3-input" type="number" step="any" placeholder="0" id="bandwidth-limit">
      </div>  
      <div class="w3-col s1" style="padding-top: 8px; padding-left: 8px; text-align: left">Mbps</div>
      <div class="w3-col s2 w3-left">
        <input class="w3-check" type="checkbox" checked="checked" id="auto-bandwidth">
        <label>Auto Control</label>
      </div>
      <div class="w3-col s2 w3-left">
        <input class="w3-check" type="checkbox" checked="checked" id="custom-bandwidth-policy">
        <label><button onclick="Fold('policy-div')">Custom</button></label>
        <p id='error-warn1' style="visibility:hidden;color:orange"><a href="javascript:alert(custom_errors)">&#9888;</a></p>
      </div>
    </div>

    <div class="w3-center w3-row w3-section" style="padding-top: 8px">
      <div class="w3-col s3 w3-center w3-white"><p style="visibility:hidden">padding</p></div>
      <div class="w3-col s2" style="padding-top: 8px">Price Setting: </div>
      <div class="w3-col s1">
        <input class="w3-input" type="number" step="0.00001" placeholder="0" id="price-setting">
      </div>  
      <div class="w3-col s1" style="padding-top: 8px; padding-left: 8px; text-align: left">Myst / GB</div>
      <div class="w3-col s2 w3-left">
        <input class="w3-check" type="checkbox" checked="checked" id="auto-price">
        <label>Auto Control</label>
      </div>
      <div class="w3-col s2 w3-left">
        <input class="w3-check" type="checkbox" checked="checked" id="custom-price-policy">
        <label><button onclick="Fold('policy-div')">Custom</button></label>
        <p id='error-warn2' style="visibility:hidden;color:orange"><a href="javascript:alert(custom_errors)">&#9888;</a></p>
      </div>
    </div>

    <div class="w3-center w3-row w3-section" style="display:none" id="policy-div">
      <div class="w3-col s3 w3-center w3-white"><p style="visibility:hidden">padding</p></div>
      <div class="w3-col s6" style="padding-top: 8px">
        <textarea class="w3-input" style="height:300px" type="text" id="policy-code">
        </textarea>
      </div>
      <div class="w3-col s2 w3-left">
        <p>Custom Policy:</p>
        <button id="submit-dvpn" onclick="SubmitCustomCode()">Submit</button>
        <button id="submit-dvpn" onclick="Fold('policy-div')">Hide</button>
      </div>
    </div>

    <div class="w3-center" style="padding-top: 16px">
      <button id="submit-dvpn" onclick="SubmitDVPN()">Submit</button>
    </div>



    <!-- <div class="w3-third w3-center">
      <i class="fa fa-anchor w3-padding-64 w3-text-grey"></i>
    </div> -->
  </div>
</div>


<script>
// Used to toggle the menu on small screens when clicking on the menu button
function myFunction() {
  var x = document.getElementById("navDemo");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else { 
    x.className = x.className.replace(" w3-show", "");
  }
}
</script>

</body>
</html>
